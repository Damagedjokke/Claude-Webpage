<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystic Realm - Your Fantasy Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #1a0933 0%, #2d1b4e 50%, #1a0933 100%);
            color: #e0d4f7;
            min-height: 100vh;
            position: relative;
            transition: background 1s ease;
        }

        body.realm-fire {
            background: linear-gradient(135deg, #4a0000 0%, #8b0000 50%, #4a0000 100%);
        }

        body.realm-ice {
            background: linear-gradient(135deg, #001a33 0%, #003d5c 50%, #001a33 100%);
        }

        body.realm-nature {
            background: linear-gradient(135deg, #0a2e0a 0%, #1a4d1a 50%, #0a2e0a 100%);
        }

        body.realm-light {
            background: linear-gradient(135deg, #4a4a00 0%, #8b8b00 50%, #4a4a00 100%);
        }

        body.realm-shadow {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0a0a0a 100%);
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
        }

        h1 {
            font-size: 3.5em;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700, 0 0 40px #ff8c00;
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 20px #ffd700, 0 0 40px #ff8c00; }
            50% { text-shadow: 0 0 30px #ffd700, 0 0 60px #ff8c00, 0 0 80px #ffd700; }
        }

        .subtitle {
            font-size: 1.3em;
            color: #b8a8d8;
            font-style: italic;
        }

        .magic-section {
            background: rgba(45, 27, 78, 0.6);
            border: 2px solid #8b5cf6;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
            min-height: 300px;
        }

        h2 {
            color: #a78bfa;
            margin-bottom: 20px;
            font-size: 2em;
            text-align: center;
        }

        .spell-casting {
            text-align: center;
            padding: 20px;
        }

        .spell-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .spell-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            font-family: 'Georgia', serif;
        }

        .spell-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 25px rgba(139, 92, 246, 0.6);
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
        }

        .spell-btn:active {
            transform: scale(0.95);
        }

        #spell-result {
            min-height: 60px;
            margin-top: 20px;
            font-size: 1.3em;
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
        }

        .crystal-game {
            text-align: center;
        }

        /* Floating crystals scattered around */
        .floating-crystal {
            position: absolute;
            width: 40px;
            height: 40px;
            font-size: 35px;
            cursor: pointer;
            z-index: 100;
            animation: float 3s ease-in-out infinite, sparkle 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px currentColor);
            transition: all 0.3s;
        }

        .floating-crystal:hover {
            transform: scale(1.4) rotate(20deg);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes sparkle {
            0%, 100% { filter: drop-shadow(0 0 5px currentColor); }
            50% { filter: drop-shadow(0 0 20px currentColor); }
        }

        .score {
            font-size: 1.5em;
            color: #ffd700;
            margin: 20px 0;
        }

        .portal {
            width: 200px;
            height: 200px;
            margin: 30px auto;
            border-radius: 50%;
            background: radial-gradient(circle, #8b5cf6 0%, #2d1b4e 70%);
            border: 3px solid #a78bfa;
            animation: portal-spin 10s linear infinite;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 40px rgba(139, 92, 246, 0.8), inset 0 0 40px rgba(139, 92, 246, 0.5);
            position: relative;
        }

        .portal:hover {
            transform: scale(1.1);
            box-shadow: 0 0 60px rgba(139, 92, 246, 1), inset 0 0 60px rgba(139, 92, 246, 0.7);
        }

        @keyframes portal-spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .portal::after {
            content: 'üåÄ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
        }

        #portal-message {
            text-align: center;
            font-size: 1.2em;
            color: #a78bfa;
            margin-top: 20px;
            min-height: 30px;
        }

        #realm-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            opacity: 0;
            transition: opacity 1s;
        }

        #realm-effect.active {
            opacity: 1;
        }

        .quest-list {
            list-style: none;
            margin-top: 20px;
        }

        .quest-item {
            background: rgba(139, 92, 246, 0.2);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #8b5cf6;
            transition: all 0.3s;
        }

        .quest-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
            border-left-color: #10b981;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #b8a8d8;
            font-style: italic;
        }

        .particle {
            position: fixed;
            pointer-events: none;
            animation: float-up 3s ease-out forwards;
            z-index: 999;
        }

        @keyframes float-up {
            to {
                transform: translateY(-100vh) scale(0);
                opacity: 0;
            }
        }

        #story-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 999;
            animation: fadeIn 0.3s ease-in;
        }

        #story-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 9, 51, 0.98);
            border: 3px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            z-index: 1000;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.6);
            animation: popIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes popIn {
            from {
                transform: translate(-50%, -50%) scale(0.8);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        #story-title {
            color: #ffd700;
            margin-bottom: 20px;
            text-align: center;
            font-size: 2em;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        #story-text {
            line-height: 1.8;
            font-size: 1.1em;
            text-align: center;
            margin-bottom: 10px;
            color: #e0d4f7;
        }

        .crystal-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(139, 92, 246, 0.9);
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-size: 1.1em;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.5);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Easter egg - mysterious water */
        .mysterious-water {
            position: absolute;
            width: 80px;
            height: 80px;
            font-size: 60px;
            cursor: pointer;
            z-index: 95;
            animation: gentle-wave 3s ease-in-out infinite;
            filter: drop-shadow(0 0 15px #00bfff);
            transition: all 0.5s;
        }

        .mysterious-water:hover {
            transform: scale(1.1);
        }

        .mysterious-water.frozen {
            animation: none;
            filter: drop-shadow(0 0 20px #00ffff);
        }

        @keyframes gentle-wave {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .easter-egg-hint {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #ffd700;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            white-space: nowrap;
            pointer-events: none;
            z-index: 96;
            animation: fadeIn 0.3s;
        }

        .completion-marker {
            position: fixed;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1em;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5);
            z-index: 1001;
            animation: popIn 0.5s ease-out;
            border: 2px solid #34d399;
            transform: translate(-50%, -50%);
        }

        /* Mountain rocks */
        .mountain-rock {
            position: absolute;
            font-size: 50px;
            cursor: pointer;
            z-index: 95;
            transition: all 0.3s;
            filter: grayscale(0.5) brightness(0.9);
        }

        .mountain-rock:hover {
            transform: scale(1.1);
            filter: grayscale(0) brightness(1.1);
        }

        .mountain-rock.cracked {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        /* Crystal revelation animation */
        .crystal-revealed {
            animation: crystalReveal 1s ease-out forwards;
        }

        @keyframes crystalReveal {
            0% {
                transform: scale(0) translateY(20px);
                opacity: 0;
            }
            60% {
                transform: scale(1.3) translateY(0);
            }
            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div id="realm-effect"></div>
    
    <div id="story-overlay" onclick="closeStory()"></div>
    <div id="story-popup">
        <h3 id="story-title"></h3>
        <p id="story-text"></p>
        <button class="spell-btn" onclick="closeStory()" style="margin-top: 30px; display: block; margin-left: auto; margin-right: auto;">Continue Your Journey</button>
    </div>
    
    <div class="container">
        <header>
            <h1>‚öîÔ∏è Mystic Realm ‚öîÔ∏è</h1>
            <p class="subtitle">Welcome, Wanderer of the Arcane</p>
        </header>

        <section class="magic-section" id="intro-section">
            <h2>üìñ Your Journey Begins</h2>
            <div style="text-align: center; line-height: 1.8; font-size: 1.1em;">
                <p style="margin-bottom: 15px;">
                    You awaken in a realm forgotten by time, where magic pulses through the very air you breathe. 
                    The ancient Crystal Guardians have summoned you for a purpose long foretold in prophecy.
                </p>
                <p style="margin-bottom: 15px;">
                    The realm's magic is fading, and only by completing the trials of the four elements 
                    can balance be restored. Each quest you complete will reveal another fragment of the truth.
                </p>
                <p style="color: #ffd700; font-style: italic;">
                    Your destiny awaits, brave wanderer. Will you answer the call?
                </p>
                <button class="spell-btn" onclick="startJourney()" style="margin-top: 20px;">
                    Begin Your Quest
                </button>
            </div>
        </section>

        <section class="magic-section quest-content" style="display: none;">
            <h2>üìú Quest Board</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <div class="score">Quests Completed: <span id="quest-progress">0/5</span></div>
            </div>
            <ul class="quest-list">
                <li class="quest-item" id="quest-0">
                    <strong>Quest I:</strong> Master the Art of Spellcasting
                    <div style="font-size: 0.9em; color: #b8a8d8; margin-top: 5px;">Cast all four elemental spells to prove your magical prowess</div>
                </li>
                <li class="quest-item" id="quest-1">
                    <strong>Quest II:</strong> Gather the Crystal Shards
                    <div style="font-size: 0.9em; color: #b8a8d8; margin-top: 5px;">Collect 10 mystical crystals hidden throughout the realm</div>
                </li>
                <li class="quest-item" id="quest-2">
                    <strong>Quest III:</strong> Journey Through the Portal
                    <div style="font-size: 0.9em; color: #b8a8d8; margin-top: 5px;">Travel through the portal 3 times to explore distant realms</div>
                </li>
                <li class="quest-item" id="quest-3">
                    <strong>Quest IV:</strong> Embrace the Elements
                    <div style="font-size: 0.9em; color: #b8a8d8; margin-top: 5px;">Cast 20 spells total to channel the elemental forces</div>
                </li>
                <li class="quest-item" id="quest-4">
                    <strong>Quest V:</strong> Become a True Mage
                    <div style="font-size: 0.9em; color: #b8a8d8; margin-top: 5px;">Complete all previous quests to unlock your destiny</div>
                </li>
            </ul>
        </section>

        <section class="magic-section quest-content" style="display: none;">
            <h2>üîÆ Cast Your Spells</h2>
            <div class="spell-casting">
                <p>Choose a spell to cast and witness the magic unfold!</p>
                <p style="color: #b8a8d8; font-size: 0.95em; margin-top: 10px; font-style: italic;">üí° Hint: Your spells can interact with mysterious objects in the realm...</p>
                <div class="spell-buttons">
                    <button class="spell-btn" onclick="castSpell('fire')">üî• Fireball</button>
                    <button class="spell-btn" onclick="castSpell('ice')">‚ùÑÔ∏è Ice Blast</button>
                    <button class="spell-btn" onclick="castSpell('lightning')">‚ö° Lightning Strike</button>
                    <button class="spell-btn" onclick="castSpell('healing')">üíö Healing Light</button>
                </div>
                <div id="spell-result"></div>
            </div>
        </section>

        <section class="magic-section quest-content" style="display: none;">
            <h2>üíé Crystal Hunt</h2>
            <div class="crystal-game">
                <p>Mystical crystals are scattered throughout the realm!</p>
                <p style="margin-top: 10px; color: #ffd700;">Scroll down and explore every corner to find them all.</p>
                <div class="score">Crystals Collected: <span id="crystal-count">0</span> / 10</div>
                <p style="margin-top: 15px; color: #b8a8d8; font-style: italic;">‚ú® Some crystals may be hidden in unexpected places...</p>
            </div>
        </section>

        <section class="magic-section quest-content" id="lake-section" style="display: none; min-height: 450px;">
            <h2>üåä The Mystic Lake</h2>
            <div style="text-align: center; padding: 40px 20px;">
                <p style="margin-bottom: 20px; font-size: 1.1em;">
                    A serene lake reflects the stars above. Its waters seem to respond to magical energies...
                </p>
                <p style="color: #b8a8d8; font-style: italic; font-size: 0.95em; margin-bottom: 15px;">
                    "Ancient texts speak of crystals forming when elements clash with nature's gifts."
                </p>
                <p style="color: #8b5cf6; font-size: 0.9em;">
                    üíß Try using your ice and fire spells on the mysterious water...
                </p>
            </div>
        </section>

        <section class="magic-section quest-content" style="display: none;">
            <h2>üåÄ The Portal</h2>
            <p style="text-align: center;">Click the swirling portal to travel between realms. Each realm transforms the very essence of reality around you...</p>
            <div class="portal" onclick="enterPortal()"></div>
            <div id="portal-message"></div>
            <div style="text-align: center; margin-top: 20px;">
                <p style="color: #b8a8d8; font-size: 0.95em;">Current Realm: <span id="current-realm" style="color: #ffd700;">Mystic Realm</span></p>
            </div>
        </section>

        <section class="magic-section quest-content" style="display: none; min-height: 550px;">
            <h2>üèîÔ∏è The Ancient Peaks</h2>
            <div style="text-align: center; padding: 40px 20px;">
                <p style="font-size: 1.1em; line-height: 1.8; margin-bottom: 20px;">
                    Towering mountains pierce the clouds, their peaks shrouded in eternal mist. 
                    Ancient boulders rest precariously on the slopes...
                </p>
                <p style="color: #b8a8d8; font-style: italic; font-size: 0.95em; margin-bottom: 15px;">
                    "Legend tells of crystals hidden beneath the stones, released only by the power of thunder."
                </p>
                <p style="color: #8b5cf6; font-size: 0.9em;">
                    ‚ö° Perhaps lightning could shatter these ancient rocks...
                </p>
            </div>
        </section>

        <footer>
            <p>‚ú® May your journey through the Mystic Realm be filled with wonder ‚ú®</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Created with magic and code</p>
        </footer>
    </div>

    <script>
        let gameState = {
            crystalCount: 0,
            spellsCast: 0,
            spellTypes: new Set(),
            portalVisits: 0,
            questsCompleted: [false, false, false, false, false],
            currentRealm: 'default',
            crystalsSpawned: false,
            waterState: 'liquid',
            easterEggFound: false,
            lastSpellCast: null,
            rocksDestroyed: 0
        };

        const questStories = [
            {
                title: "‚ö° The First Spark",
                text: "As you master each element, you feel ancient power flowing through your veins. The Crystal Guardians whisper their approval. Fire, ice, lightning, and life‚Äîyou've proven yourself worthy of wielding their forces. But this is only the beginning..."
            },
            {
                title: "üíé Fragments of Power",
                text: "The crystals resonate in harmony, their combined energy revealing a vision: long ago, a great mage shattered the Eternal Crystal to prevent a dark force from claiming it. You've gathered enough fragments to sense its original power. The darkness stirs once more..."
            },
            {
                title: "üåÄ Between Worlds",
                text: "Each realm you visit leaves its mark upon your soul. You begin to understand‚Äîthese aren't mere destinations, but echoes of what this realm once was. The portals are weakening, the boundaries between worlds growing thin. Time is running short."
            },
            {
                title: "üî• Elemental Mastery",
                text: "Your connection to the elements deepens with each spell. You no longer merely cast magic‚Äîyou ARE magic. The realm responds to your presence, the very air shimmering with potential. The Crystal Guardians deem you ready for the final trial."
            },
            {
                title: "üëë The Prophecy Fulfilled",
                text: "As the final quest completes, brilliant light erupts from within you. The crystal fragments unite, reforming the Eternal Crystal in your hands. You understand now‚ÄîYOU are the guardian this realm has waited for. The darkness that once threatened to consume everything retreats before your radiance. Balance is restored, and the Mystic Realm flourishes once more. Your legend will be told for ages to come, brave mage. You are the realm's eternal protector, the one who answered destiny's call. Thank you for your courage. üåü"
            }
        ];

        const starsContainer = document.getElementById('stars');
        for (let i = 0; i < 100; i++) {
            const star = document.createElement('div');
            star.className = 'star';
            star.style.width = Math.random() * 3 + 'px';
            star.style.height = star.style.width;
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';
            star.style.animationDelay = Math.random() * 3 + 's';
            starsContainer.appendChild(star);
        }

        function startJourney() {
            document.getElementById('intro-section').style.display = 'none';
            document.querySelectorAll('.quest-content').forEach(el => el.style.display = 'block');
            showStory("üó°Ô∏è Your Journey Begins", "The realm awakens to your presence. The quest board materializes before you, ancient runes glowing with purpose. Study your tasks carefully, young mage‚Äîeach completed quest will reveal another fragment of the realm's ancient mystery.");
            
            setTimeout(() => {
                spawnFloatingCrystals();
                createMysteriousWater();
                createMountainRocks();
            }, 1000);
        }

        function createMysteriousWater() {
            const lakeSection = document.getElementById('lake-section');
            
            const water = document.createElement('div');
            water.className = 'mysterious-water';
            water.textContent = 'üíß';
            water.id = 'mysterious-water';
            water.style.left = '50%';
            water.style.top = '65%';
            water.style.transform = 'translateX(-50%)';
            
            water.onclick = function() {
                interactWithWater();
            };
            
            lakeSection.appendChild(water);
        }

        function interactWithWater() {
            const water = document.getElementById('mysterious-water');
            if (!water) return;

            if (gameState.waterState === 'liquid') {
                if (gameState.lastSpellCast === 'ice') {
                    gameState.waterState = 'frozen';
                    water.textContent = 'üßä';
                    water.classList.add('frozen');
                    showHint(water, "The water has frozen solid! üßä");
                    
                    for (let i = 0; i < 20; i++) {
                        setTimeout(() => {
                            const particle = document.createElement('div');
                            particle.className = 'particle';
                            particle.textContent = '‚ùÑÔ∏è';
                            particle.style.left = water.offsetLeft + water.offsetWidth / 2 + 'px';
                            particle.style.top = water.offsetTop + water.offsetHeight / 2 + 'px';
                            particle.style.fontSize = '20px';
                            particle.style.color = '#00ffff';
                            document.body.appendChild(particle);
                            setTimeout(() => particle.remove(), 3000);
                        }, i * 50);
                    }
                } else {
                    showHint(water, "The water ripples... Perhaps ice magic?");
                }
            } else if (gameState.waterState === 'frozen') {
                if (gameState.lastSpellCast === 'fire') {
                    gameState.waterState = 'melted';
                    showHint(water, "The ice melts away, revealing something beneath! ‚ú®");
                    
                    for (let i = 0; i < 15; i++) {
                        setTimeout(() => {
                            const particle = document.createElement('div');
                            particle.className = 'particle';
                            particle.textContent = ['üíß', 'üî•'][Math.floor(Math.random() * 2)];
                            particle.style.left = water.offsetLeft + water.offsetWidth / 2 + 'px';
                            particle.style.top = water.offsetTop + water.offsetHeight / 2 + 'px';
                            particle.style.fontSize = '25px';
                            document.body.appendChild(particle);
                            setTimeout(() => particle.remove(), 3000);
                        }, i * 80);
                    }
                    
                    setTimeout(() => {
                        water.style.transition = 'all 1s';
                        water.style.opacity = '0';
                        water.style.transform = 'translateX(-50%) scale(0)';
                        
                        setTimeout(() => {
                            const lakeSection = document.getElementById('lake-section');
                            water.remove();
                            spawnSecretCrystal(lakeSection);
                            gameState.easterEggFound = true;
                        }, 1000);
                    }, 1500);
                } else {
                    showHint(water, "The ice is solid... Fire might melt it!");
                }
            }
        }

        function createMountainRocks() {
            const sections = document.querySelectorAll('.magic-section');
            const mountainSection = sections[6];
            
            // Using more compatible emojis
            const rockPositions = [
                { x: '20%', y: '60%', emoji: '‚õ∞Ô∏è' },
                { x: '50%', y: '65%', emoji: 'üóø' },
                { x: '75%', y: '58%', emoji: '‚õ∞Ô∏è' }
            ];
            
            rockPositions.forEach((pos, index) => {
                const rock = document.createElement('div');
                rock.className = 'mountain-rock';
                rock.textContent = pos.emoji;
                rock.id = `rock-${index}`;
                rock.style.left = pos.x;
                rock.style.top = pos.y;
                rock.style.transform = 'translateX(-50%)';
                
                rock.onclick = function() {
                    strikeRock(this, index);
                };
                
                mountainSection.appendChild(rock);
            });
        }

        function strikeRock(rock, index) {
            if (gameState.lastSpellCast === 'lightning') {
                rock.classList.add('cracked');
                showHint(rock, "‚ö° Lightning shatters the rock!");
                
                for (let i = 0; i < 25; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.textContent = ['‚ö°', 'üí•', '‚ú®'][Math.floor(Math.random() * 3)];
                        const angle = (i / 25) * Math.PI * 2;
                        const distance = 60;
                        particle.style.left = rock.offsetLeft + rock.offsetWidth / 2 + Math.cos(angle) * distance + 'px';
                        particle.style.top = rock.offsetTop + rock.offsetHeight / 2 + Math.sin(angle) * distance + 'px';
                        particle.style.fontSize = '25px';
                        particle.style.color = '#ffff00';
                        document.body.appendChild(particle);
                        setTimeout(() => particle.remove(), 3000);
                    }, i * 30);
                }
                
                setTimeout(() => {
                    const rockPos = {
                        left: rock.offsetLeft,
                        top: rock.offsetTop
                    };
                    rock.remove();
                    gameState.rocksDestroyed++;
                    
                    spawnRockCrystal(rockPos.left, rockPos.top);
                }, 800);
            } else {
                showHint(rock, "The rock is too sturdy... Try lightning!");
            }
        }

        function spawnRockCrystal(x, y) {
            const crystalEmojis = ['üíé', 'üî∑', '‚ú®'];
            const crystal = document.createElement('div');
            crystal.className = 'floating-crystal crystal-revealed';
            crystal.textContent = crystalEmojis[gameState.rocksDestroyed % 3];
            crystal.style.color = '#ffd700';
            crystal.style.fontSize = '45px';
            crystal.style.position = 'fixed';
            crystal.style.left = x + 'px';
            crystal.style.top = y + 'px';
            
            crystal.onclick = function() {
                collectFloatingCrystal(this, true);
            };
            
            document.body.appendChild(crystal);
        }

        function showHint(element, text) {
            const hint = document.createElement('div');
            hint.className = 'easter-egg-hint';
            hint.textContent = text;
            hint.style.left = element.offsetLeft + 'px';
            hint.style.top = (element.offsetTop - 50) + 'px';
            document.body.appendChild(hint);
            setTimeout(() => hint.remove(), 3000);
        }

        function spawnSecretCrystal(lakeSection) {
            const crystal = document.createElement('div');
            crystal.className = 'floating-crystal crystal-revealed';
            crystal.textContent = 'üíé';
            crystal.style.color = '#ff00ff';
            crystal.style.fontSize = '50px';
            crystal.style.left = '50%';
            crystal.style.top = '65%';
            crystal.style.transform = 'translateX(-50%)';
            
            crystal.onclick = function() {
                collectFloatingCrystal(this, true);
            };
            
            lakeSection.appendChild(crystal);

            const hint = document.createElement('div');
            hint.className = 'crystal-hint';
            hint.textContent = 'üéâ Secret Crystal Revealed! Click to collect it!';
            hint.style.background = 'linear-gradient(135deg, #ff00ff, #00ffff)';
            document.body.appendChild(hint);
            setTimeout(() => hint.remove(), 5000);
        }

        function spawnFloatingCrystals() {
            if (gameState.crystalsSpawned) return;
            gameState.crystalsSpawned = true;

            const crystalEmojis = ['üíé', 'üí†', 'üî∑', 'üîπ', 'üíô', 'üíú', 'üîÆ', '‚ú®', '‚≠ê'];
            const colors = ['#00ffff', '#ff00ff', '#00ff00', '#ffff00', '#ff0080', '#0080ff', '#ff8000', '#8000ff', '#00ff80'];
            
            const sections = document.querySelectorAll('.magic-section');
            
            // Random spawn positions for each crystal
            for (let i = 0; i < 9; i++) {
                setTimeout(() => {
                    const crystal = document.createElement('div');
                    crystal.className = 'floating-crystal';
                    crystal.textContent = crystalEmojis[i];
                    crystal.style.color = colors[i];
                    
                    // Random section (skip intro section)
                    const randomSection = Math.floor(Math.random() * 6) + 1;
                    
                    // Random position within section
                    crystal.style.left = (Math.random() * 80 + 10) + '%';
                    crystal.style.top = (Math.random() * 200 + 100) + 'px';
                    
                    crystal.style.animationDelay = Math.random() * 3 + 's';
                    
                    crystal.onclick = function() {
                        collectFloatingCrystal(this, false);
                    };
                    
                    sections[randomSection].appendChild(crystal);
                }, i * 300);
            }

            const hint = document.createElement('div');
            hint.className = 'crystal-hint';
            hint.textContent = '‚ú® Crystals have appeared! Scroll to explore!';
            document.body.appendChild(hint);
            setTimeout(() => hint.remove(), 4000);
        }

        function collectFloatingCrystal(element, isSpecial) {
            gameState.crystalCount++;
            document.getElementById('crystal-count').textContent = gameState.crystalCount;
            
            // Get screen position before removing
            const rect = element.getBoundingClientRect();
            const screenX = rect.left + rect.width / 2;
            const screenY = rect.top + rect.height / 2;
            
            element.style.transition = 'all 0.6s';
            element.style.transform = 'scale(3) rotate(720deg)';
            element.style.opacity = '0';
            
            for (let i = 0; i < 15; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'particle';
                sparkle.textContent = '‚ú®';
                const angle = (i / 15) * Math.PI * 2;
                const distance = 80;
                sparkle.style.left = screenX + Math.cos(angle) * distance + 'px';
                sparkle.style.top = screenY + Math.sin(angle) * distance + 'px';
                sparkle.style.fontSize = '30px';
                sparkle.style.color = element.style.color;
                document.body.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 3000);
            }
            
            setTimeout(() => {
                element.remove();
                
                const marker = document.createElement('div');
                marker.className = 'completion-marker';
                marker.textContent = isSpecial ? '‚úÖ Secret Collected!' : '‚úÖ Crystal Found!';
                marker.style.left = screenX + 'px';
                marker.style.top = screenY + 'px';
                document.body.appendChild(marker);
                
                setTimeout(() => {
                    marker.style.opacity = '0';
                    marker.style.transition = 'opacity 0.5s';
                    setTimeout(() => marker.remove(), 500);
                }, 2000);
            }, 600);

            if (isSpecial) {
                const hint = document.createElement('div');
                hint.className = 'crystal-hint';
                hint.textContent = 'üèÜ Bonus Crystal! +1';
                hint.style.background = 'linear-gradient(135deg, #ffd700, #ff8c00)';
                document.body.appendChild(hint);
                setTimeout(() => hint.remove(), 3000);
            }

            checkQuests();
        }

        function showStory(title, text) {
            document.getElementById('story-title').textContent = title;
            document.getElementById('story-text').textContent = text;
            document.getElementById('story-popup').style.display = 'block';
            document.getElementById('story-overlay').style.display = 'block';
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.textContent = ['‚ú®', '‚≠ê', 'üåü'][Math.floor(Math.random() * 3)];
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    particle.style.fontSize = Math.random() * 20 + 15 + 'px';
                    particle.style.color = '#ffd700';
                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 3000);
                }, i * 50);
            }
        }

        function closeStory() {
            document.getElementById('story-popup').style.display = 'none';
            document.getElementById('story-overlay').style.display = 'none';
        }

        function checkQuests() {
            if (!gameState.questsCompleted[0] && gameState.spellTypes.size >= 4) {
                completeQuest(0);
            }
            if (!gameState.questsCompleted[1] && gameState.crystalCount >= 10) {
                completeQuest(1);
            }
            if (!gameState.questsCompleted[2] && gameState.portalVisits >= 3) {
                completeQuest(2);
            }
            if (!gameState.questsCompleted[3] && gameState.spellsCast >= 20) {
                completeQuest(3);
            }
            if (!gameState.questsCompleted[4] && 
                gameState.questsCompleted[0] && 
                gameState.questsCompleted[1] && 
                gameState.questsCompleted[2] && 
                gameState.questsCompleted[3]) {
                completeQuest(4);
            }
        }

        function completeQuest(questIndex) {
            gameState.questsCompleted[questIndex] = true;
            const questElement = document.getElementById(`quest-${questIndex}`);
            questElement.classList.add('completed');
            
            const completed = gameState.questsCompleted.filter(q => q).length;
            document.getElementById('quest-progress').textContent = `${completed}/5`;

            setTimeout(() => {
                showStory(questStories[questIndex].title, questStories[questIndex].text);
            }, 800);
        }

        const spellMessages = {
            fire: [
                "üî• A mighty fireball erupts from your hands!",
                "üî• Flames dance around you, warming the realm!",
                "üî• Your fire magic burns bright and fierce!"
            ],
            ice: [
                "‚ùÑÔ∏è Icy crystals form in the air around you!",
                "‚ùÑÔ∏è A freezing blast chills the atmosphere!",
                "‚ùÑÔ∏è Winter's embrace flows through your magic!"
            ],
            lightning: [
                "‚ö° Thunder crashes as lightning strikes!",
                "‚ö° Electric energy crackles through the air!",
                "‚ö° The power of the storm courses through you!"
            ],
            healing: [
                "üíö A warm, soothing light envelops you!",
                "üíö Life energy flows through the realm!",
                "üíö Your healing magic brings peace and renewal!"
            ]
        };

        function castSpell(spellType) {
            gameState.spellsCast++;
            gameState.spellTypes.add(spellType);
            gameState.lastSpellCast = spellType;
            
            const messages = spellMessages[spellType];
            const message = messages[Math.floor(Math.random() * messages.length)];
            const resultDiv = document.getElementById('spell-result');
            
            resultDiv.style.animation = 'none';
            setTimeout(() => {
                resultDiv.textContent = message;
                resultDiv.style.animation = 'glow 1s ease-in-out 3';
            }, 10);

            createParticles(spellType);
            checkQuests();
        }

        function createParticles(type) {
            const colors = {
                fire: ['#ff4500', '#ff8c00', '#ffd700'],
                ice: ['#00ffff', '#87ceeb', '#ffffff'],
                lightning: ['#ffff00', '#ffffff', '#9370db'],
                healing: ['#00ff00', '#90ee90', '#98fb98']
            };

            const emojis = {
                fire: 'üî•',
                ice: '‚ùÑÔ∏è',
                lightning: '‚ö°',
                healing: 'üíö'
            };

            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.textContent = emojis[type];
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = window.innerHeight - 100 + 'px';
                    particle.style.fontSize = Math.random() * 20 + 20 + 'px';
                    particle.style.color = colors[type][Math.floor(Math.random() * colors[type].length)];
                    document.body.appendChild(particle);

                    setTimeout(() => particle.remove(), 3000);
                }, i * 100);
            }
        }

        const realms = [
            {
                name: 'Realm of Eternal Flames',
                class: 'realm-fire',
                message: "üî• You step through into a world of endless fire! Lava flows like rivers, and the air shimmers with heat. Ancient dragons circle overhead...",
                emoji: 'üî•'
            },
            {
                name: 'Frozen Dimension',
                class: 'realm-ice',
                message: "‚ùÑÔ∏è The portal opens to a crystalline winter wonderland! Frost coats everything, and auroras dance across frozen skies...",
                emoji: '‚ùÑÔ∏è'
            },
            {
                name: 'Verdant Paradise',
                class: 'realm-nature',
                message: "üåø You emerge in an ancient forest realm! Massive trees reach toward the heavens, and magical creatures frolic among glowing flowers...",
                emoji: 'üåø'
            },
            {
                name: 'Celestial Heights',
                class: 'realm-light',
                message: "‚ú® The portal brings you to a realm of pure light! Golden clouds drift beneath your feet, and divine music fills the air...",
                emoji: '‚ú®'
            },
            {
                name: 'Shadow Depths',
                class: 'realm-shadow',
                message: "üåë You enter the mysterious shadow realm! Darkness swirls around you, revealing glimpses of hidden truths and ancient secrets...",
                emoji: 'üåë'
            }
        ];

        function enterPortal() {
            gameState.portalVisits++;
            const realm = realms[Math.floor(Math.random() * realms.length)];
            
            document.body.className = realm.class;
            document.getElementById('current-realm').textContent = realm.name;
            
            const messageDiv = document.getElementById('portal-message');
            messageDiv.textContent = realm.message;
            messageDiv.style.animation = 'glow 2s ease-in-out';
            
            const effectDiv = document.getElementById('realm-effect');
            effectDiv.className = 'active';
            effectDiv.innerHTML = '';
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.textContent = realm.emoji;
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    particle.style.fontSize = Math.random() * 40 + 20 + 'px';
                    effectDiv.appendChild(particle);
                }, i * 30);
            }
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.textContent = 'üåü';
                    const angle = (i / 30) * Math.PI * 2;
                    const distance = 50 + i * 10;
                    particle.style.left = (window.innerWidth / 2 + Math.cos(angle) * distance) + 'px';
                    particle.style.top = (window.innerHeight / 2 + Math.sin(angle) * distance) + 'px';
                    particle.style.fontSize = Math.random() * 30 + 20 + 'px';
                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 3000);
                }, i * 50);
            }
            
            setTimeout(() => {
                effectDiv.classList.remove('active');
                setTimeout(() => {
                    document.body.className = '';
                    document.getElementById('current-realm').textContent = 'Mystic Realm';
                }, 1000);
            }, 10000);

            checkQuests();
        }
    </script>
</body>
</html>
